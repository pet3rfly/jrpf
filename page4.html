<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å›½é“¶è¡Œ - ç­¾ç½²æ„è§</title>
    <style>
        :root {
            --font-song: "SimSun", "Songti SC", serif;
            --font-yahei: "Microsoft YaHei", "Segoe UI", sans-serif;
            --border-color: #000;
            --text-color: #000;
        }

        @page { size: A4; margin: 0; }

        body {
            background-color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-color);
            font-family: var(--font-song); 
        }

        .a4-page {
            background: white;
            width: 210mm;
            height: 297mm;
            padding: 15mm 15mm;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            position: relative;
            box-sizing: border-box;
            overflow: hidden;
        }

        @media print {
            body { background: none; padding: 0; }
            .a4-page {
                box-shadow: none;
                width: 210mm; height: 297mm;
                margin: 0; padding: 15mm 15mm;
                page-break-after: always;
            }
            .control-panel, .print-btn-float { display: none !important; }
            -webkit-print-color-adjust: exact;
        }

        /* ä»¿çœŸé¡µçœ‰é¡µè„š */
        .fake-header {
            position: absolute; top: 5mm; left: 10mm; right: 10mm;
            display: flex; justify-content: space-between;
            font-size: 16px; color: #000; font-family: var(--font-song);
        }
        .fake-footer {
            position: absolute; bottom: 5mm; left: 10mm; right: 10mm;
            display: flex; justify-content: space-between;
            font-size: 16px; color: #000; font-family: var(--font-song);
        }

        .content-wrapper { margin-top: 35px; }

        .sub-header {
            display: flex; justify-content: space-between;
            font-size: 12px; border-bottom: 1px solid #000;
            padding-bottom: 5px; margin-bottom: 30px;
            font-family: var(--font-yahei);
            padding-left: 2em; padding-right: 2em;
        }

        .main-title {
            text-align: center; font-weight: bold; font-size: 14px;
            margin-bottom: 20px; font-family: var(--font-yahei);
        }

        /* è¡¨æ ¼é€šç”¨æ ·å¼ */
        table {
            width: 100%; border-collapse: collapse; margin-bottom: 25px;
            table-layout: fixed; /* å…³é”®ï¼šå›ºå®šå¸ƒå±€ */
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 4px 2px; /* å‡å°å·¦å³å†…è¾¹è·ï¼Œé˜²æ­¢æ’‘å¼€ */
            text-align: center; vertical-align: middle;
            font-size: 10px; /* æ­£æ–‡10px */
            font-family: var(--font-song);
            word-wrap: break-word; /* é˜²æ­¢é•¿æ•°å­—æ’‘ç ´ */
        }

        tr { height: 36px; }

        .section-header-row td {
            text-align: left; padding-left: 0;
            border: 1px solid var(--border-color);
            background-color: #fff; height: 30px;
        }

        .section-title-container {
            display: flex; align-items: center;
            font-family: var(--font-yahei); font-weight: bold;
            font-size: 14px; padding-left: 5px;
        }

        .icon-img { width: 16px; height: 16px; display: block; z-index: 1; }
        .title-text { position: relative; z-index: 2; margin-left: -6px; background: transparent; }
        .align-left { text-align: left !important; padding-left: 10px; }
        thead th { font-weight: normal; font-size: 10px; font-family: var(--font-song); }

        /* æ°´å° */
        #watermark-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 99;
            overflow: hidden; display: flex; flex-wrap: wrap; align-content: flex-start;
        }
        .watermark-item {
            display: flex; align-items: center; justify-content: center;
            color: rgba(200, 200, 200, 0.35); font-weight: normal;
            transform: rotate(-30deg); white-space: nowrap; font-family: var(--font-yahei);
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            position: fixed; bottom: 20px; right: 20px; background: #fff;
            border: 1px solid #ccc; padding: 15px; z-index: 10000;
            width: 280px; box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 8px; font-size: 12px; font-family: var(--font-yahei);
            transition: all 0.3s ease;
        }
        .control-panel.collapsed {
            width: 40px; height: 40px; padding: 0; border-radius: 50%;
            background: #b71c1c; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .control-panel.collapsed .panel-content { display: none; }
        .toggle-icon { display: none; color: white; font-size: 20px; }
        .control-panel.collapsed .toggle-icon { display: block; }
        .panel-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #eee; margin-bottom: 10px; padding-bottom: 5px;
        }
        .minimize-btn { 
            cursor: pointer; font-size: 16px; width: 16px; height: 16px; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: bold; color: #666;
        }
        .minimize-btn:hover { background-color: #f0f0f0; }
        .control-row { margin-bottom: 10px; }
        .control-row label { display: block; margin-bottom: 3px; font-weight: bold; color: #555; }
        .control-row input, .control-row select { width: 95%; padding: 5px; border: 1px solid #ddd; }
        .slider-container { display: flex; align-items: center; justify-content: space-between; }
        .slider-container input { width: 70%; }
        .btn-action { width: 100%; padding: 6px; background: #f0f0f0; border: 1px solid #ccc; cursor: pointer; margin-top: 5px; }
        .print-btn-float {
            position: fixed; top: 20px; right: 20px; padding: 10px 20px;
            background: #b71c1c; color: #fff; border: none; border-radius: 4px;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            font-size: 14px; font-family: var(--font-yahei); z-index: 10001;
        }
        .print-btn-float:hover { background: #d32f2f; }
    </style>
</head>
<body>

    <button class="print-btn-float" onclick="window.print()">ğŸ–¨ï¸ æ‰“å° / ä¸‹è½½PDF</button>

    <div class="a4-page">
        <div class="fake-header">
            <span>RLMS</span>
            <span>é¡µç ï¼Œ1/1</span>
        </div>

        <div id="watermark-layer"></div>

        <div class="content-wrapper">
            <div class="sub-header">
                <span>å½“å‰ä½ç½®ï¼šç­¾ç½²æ„è§</span>
                <span>å½“å‰æµæ°´å·ï¼š<span id="txtSerialHeader">2018632086193</span></span>
            </div>

            <div class="main-title">ç­¾ç½²æ„è§</div>

            <table>
                <colgroup>
                    <col style="width: 28.5%"> <col style="width: 14.3%"> <col style="width: 14.3%"> <col style="width: 28.5%"> <col style="width: 14.4%"> </colgroup>
                <tr class="section-header-row">
                    <td colspan="5">
                        <div class="section-title-container">
                            <img src="./icon_doc.svg" class="icon-img" alt="">
                            <span class="title-text">æµæ°´ä¿¡æ¯</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>å·¥ä½œæµæ°´</td>
                    <td>æµæ°´ç±»å‹</td>
                    <td>å€Ÿæ¬¾äºº</td>
                    <td>è´·æ¬¾é‡‘é¢</td>
                    <td>ç»åŠ</td>
                </tr>
                <tr>
                    <td id="txtSerialTable">2018632086193</td>
                    <td>è´·æ¬¾</td>
                    <td id="txtBorrowerTable">ä¸¥ä»ç²</td>
                    <td id="txtAmountTable">CNY 4,800,000.00</td>
                    <td id="txtHandlerTable">9235394</td>
                </tr>
            </table>

            <table>
                <colgroup>
                    <col style="width: 42.8%"> 
                    <col style="width: 42.8%">
                    <col style="width: 14.4%">
                </colgroup>
                <tr class="section-header-row">
                    <td colspan="3">
                        <div class="section-title-container">
                            <img src="./icon_doc.svg" class="icon-img" alt="">
                            <span class="title-text">é£é™©ä¿¡æ¯</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>æŸ¥çœ‹é£é™©é¢„è­¦ä¿¡æ¯</td>
                    <td>é£é™©é¢„è­¦ä¿¡æ¯å·²é˜…</td>
                    <td></td> </tr>
            </table>

            <table>
                <colgroup>
                    <col style="width: 42.8%">
                    <col style="width: 57.2%">
                </colgroup>
                <tr class="section-header-row">
                    <td colspan="2">
                        <div class="section-title-container">
                            <img src="./icon_doc.svg" class="icon-img" alt="">
                            <span class="title-text">è´·å‰è°ƒæŸ¥å®¡æ ¸æ„è§</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>è´·å‰è°ƒæŸ¥</td>
                    <td class="align-left" style="height: 40px;"></td>
                </tr>
                <tr>
                    <td>è´·å‰è°ƒæŸ¥æ ¸æ„è§</td>
                    <td class="align-left">åŒæ„</td>
                </tr>
            </table>

            <table>
                <colgroup>
                    <col style="width: 28.5%">
                    <col style="width: 28.6%"> <col style="width: 28.5%"> <col style="width: 14.4%">
                </colgroup>
                <tr class="section-header-row">
                    <td colspan="4">
                        <div class="section-title-container">
                            <img src="./icon_doc.svg" class="icon-img" alt="">
                            <span class="title-text">æ„è§ä¿¡æ¯</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>ç”³è¯·å€Ÿæ¬¾é‡‘é¢(å…ƒ)ï¼š</td>
                    <td class="align-left" id="txtAmountRaw">4800000</td>
                    <td>è´·æ¬¾æœŸé™(æœˆ)ï¼š</td>
                    <td class="align-left" id="txtTermTable">120</td>
                </tr>
                <tr>
                    <td>æ”¾æ¬¾å‰æ¡ä»¶ï¼š</td>
                    <td colspan="3" class="align-left" style="height: 50px; vertical-align: top;"><p></p>â– æŠµæŠ¼åˆåŒç­¾ç½²</td>
                </tr>
                <tr>
                    <td>å®¡æ‰¹ç»“è®º</td>
                    <td colspan="3" class="align-left" style="height: 40px;">åŒæ„</td>
                </tr>
            </table>
        </div>

        <div class="fake-footer">
            <span style="font-family: Arial;">http://21.123.93.107/RLMS/retailCreditSign.do</span>
            <span style="font-family: Arial;" id="txtFooterDate">2025/11/07</span>
        </div>
    </div>

    <div class="control-panel" id="controlPanel">
        <div class="toggle-icon" onclick="toggleControlPanel()">âš™</div>
        <div class="panel-content">
            <div class="panel-header">
                <h4>å†…å®¹è®¾ç½®</h4>
                <span class="minimize-btn" onclick="toggleControlPanel()" title="æ”¶èµ·">_</span>
            </div>
            <div class="control-row">
                <label>å·¥ä½œæµæ°´ (å¹´ä»½+9ä½)</label>
                <button class="btn-action" onclick="refreshSerial()">åˆ·æ–°æµæ°´å·</button>
            </div>
            <div class="control-row">
                <label>å€Ÿæ¬¾äºº</label>
                <input type="text" id="inpBorrower" value="ä¸¥ä»ç²" oninput="updateContent()">
            </div>
            <div class="control-row">
                <label>è´·æ¬¾é‡‘é¢ (å…ƒ)</label>
                <input type="number" id="inpAmount" value="4800000" oninput="updateContent()">
            </div>
            <div class="control-row">
                <label>è´·æ¬¾æœŸé™ (æœˆ)</label>
                <select id="selTerm" onchange="updateContent()">
                    <option value="12">12</option>
                    <option value="24">24</option>
                    <option value="36">36</option>
                    <option value="60">60</option>
                    <option value="120" selected>120</option>
                    <option value="360">360</option>
                </select>
            </div>
            <div class="control-row">
                <label>ç»åŠ (åˆ·æ–°ç”Ÿæˆ)</label>
                <button class="btn-action" onclick="refreshHandler()">åˆ·æ–°ç»åŠäºº</button>
                <input type="text" id="inpHandler" value="9235394" readonly style="background:#eee; margin-top:5px;">
            </div>
            <div class="control-row">
                <label>æ°´å°å¯†åº¦ (å·¦å¯† - å³ç–)</label>
                <div class="slider-container">
                    <input type="range" id="inpDensity" min="0.5" max="3.0" step="0.1" value="0.7" oninput="updateContent()">
                    <span id="txtDensity">0.7</span>
                </div>
            </div>
            <div class="control-row">
                <label>æ°´å°å­—å· (px)</label>
                <div class="slider-container">
                    <input type="range" id="inpFontSize" min="12" max="36" step="1" value="13" oninput="updateContent()">
                    <span id="txtFontSize">13</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            const now = new Date();
            const yyyy = now.getFullYear();
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const dd = String(now.getDate()).padStart(2, '0');
            document.getElementById('txtFooterDate').innerText = `${yyyy}/${mm}/${dd}`;
            updateContent();
        };

        function toggleControlPanel() {
            document.getElementById('controlPanel').classList.toggle('collapsed');
        }

        function refreshSerial() {
            const year = new Date().getFullYear();
            let random9 = "";
            for(let i=0; i<9; i++) { random9 += Math.floor(Math.random() * 10); }
            const serial = year + random9;
            document.getElementById('txtSerialHeader').innerText = serial;
            document.getElementById('txtSerialTable').innerText = serial;
        }

        function refreshHandler() {
            let random6 = "";
            for(let i=0; i<6; i++) { random6 += Math.floor(Math.random() * 10); }
            const handler = "9" + random6;
            document.getElementById('inpHandler').value = handler;
            updateContent();
        }

        function updateContent() {
            const borrower = document.getElementById('inpBorrower').value;
            const amount = document.getElementById('inpAmount').value;
            const term = document.getElementById('selTerm').value;
            const handler = document.getElementById('inpHandler').value;
            const density = parseFloat(document.getElementById('inpDensity').value);
            const fontSize = parseInt(document.getElementById('inpFontSize').value);
            
            document.getElementById('txtDensity').innerText = density;
            document.getElementById('txtFontSize').innerText = fontSize;
            document.getElementById('txtBorrowerTable').innerText = borrower;

            const moneyFloat = parseFloat(amount);
            if (!isNaN(moneyFloat)) {
                const formatted = moneyFloat.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                document.getElementById('txtAmountTable').innerText = "CNY " + formatted;
                document.getElementById('txtAmountRaw').innerText = amount;
            }

            document.getElementById('txtTermTable').innerText = term;
            document.getElementById('txtHandlerTable').innerText = handler;
            updateWatermark(handler, density, fontSize);
        }

        function updateWatermark(handler, density, fontSize) {
            const container = document.getElementById('watermark-layer');
            container.innerHTML = ''; 
            const now = new Date();
            const yyyy = now.getFullYear();
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const dd = String(now.getDate()).padStart(2, '0');
            const dateStr = `${yyyy}${mm}${dd}`; 
            const text = `${handler} ${dateStr}`;
            
            const baseWidthPercent = 33.3;
            let itemWidthPercent = baseWidthPercent * density;
            if (itemWidthPercent > 100) itemWidthPercent = 100;
            const total = 30; 

            for(let i=0; i<total; i++) {
                const div = document.createElement('div');
                div.className = 'watermark-item';
                div.innerText = text;
                div.style.width = itemWidthPercent + '%'; 
                div.style.fontSize = fontSize + 'px';
                div.style.height = '150px'; 
                container.appendChild(div);
            }
        }
    </script>
</body>

</html>
